<nav *ngIf="this.srv.pers && !this.srv.isDialogOpen" class="fixed-bottom">
  <div class="d-flex w-100 justify-content-end px-2 py-2">
    <!-- –ù–∞–∑–∞–¥ -->
    <button *ngIf="!isEditMode" mat-icon-button (click)="goBack()" class="mx-2">
      <img src="assets/icons/left.png" class="img-fluid" [ngStyle]="{'object-fit': 'contain', 'height':'2.5em'}">
    </button>
    <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å -->
    <button mat-icon-button (click)="saveData()" *ngIf="this.srv.selTabPersList!=3">
      <img *ngIf="!isEditMode" src="assets/icons/edit.png" class="img-fluid"
        [ngStyle]="{'object-fit': 'contain', 'height':'3em'}">
      <img *ngIf="isEditMode" src="assets/icons/create.png" class="img-fluid"
        [ngStyle]="{'object-fit': 'contain', 'height':'3em'}">
    </button>
  </div>
</nav>

<div class="container pt-2 pb-4" *ngIf="this.srv.pers">
  <mat-tab-group mat-align-tabs="center" animationDuration="0ms" [(selectedIndex)]="this.srv.selTabPersList">
    <mat-tab label="–ü–µ—Ä—Å">
      <!-- –ü—Ä–æ—Å–º–æ—Ç—Ä -->
      <div *ngIf="!isEditMode" class="pt-2 pb-4 w-100">

        <div class="pb-4">
          <!-- –ö–∞—Ä—Ç–∏–Ω–∫–∞ -->
          <div class="text-center p-1">
            <img src="{{this.srv.pers.image}}" class="img-fluid rounded"
              [ngStyle]="{'object-fit': 'contain', 'height': '30vh'}">
          </div>
          <div fxLayout="row" fxLayoutAlign="space-between center">
            <span>
              <img src="assets/icons/–æ–ø—ã—Ç.png" class="img-fluid"
                [ngStyle]="{'object-fit': 'contain', 'height':'1.5em'}">
              <span>
                {{(this.srv.pers.level)}}
              </span>
            </span>

            <!-- –ò–º—è -->
            <div class="text-center text-dark">
              <!-- {{this.srv.pers.name + ' (' + (this.srv.pers.rang.name|lowercase) + ')'}} -->
              {{this.srv.pers.name}}
            </div>

            <span>
              <img src="assets/icons/diamond.png" class="img-fluid"
                [ngStyle]="{'object-fit': 'contain', 'height':'1.5em'}">
              <span>
                {{this.srv.pers.ON}}
              </span>
            </span>

          </div>

          <!-- –ò—Å—Ç–æ—Ä–∏—è -->
          <div class="md-form" *ngIf="this.srv.pers.story">
            <i>{{this.srv.pers.story}}</i>
          </div>

          <!-- –ê—Ç—Ä–∏–±—É—Ç—ã -->
          <ng-container *ngIf="this.srv.pers.characteristics?.length > 0">
            <!-- <h5>–ê—Ç—Ä–∏–±—É—Ç—ã:</h5> -->
            <!-- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
            <ul class="list-group py-0">
              <li *ngFor="let item of this.srv.pers.characteristics; let i = index;"
                class="list-group-item pb-0 px-0 mt-0 mb-0 border-0">
                <!-- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ -->
                <a class="align-self-center w-100" [routerLink]="['/characteristic', item.id]">
                  <div class="d-flex">
                    <div class="flex-grow-1 text-left align-self-baseline">
                      <h4>{{item.name}}</h4>
                    </div>
                    <div class="text-right align-self-baseline">
                      <h4>{{item.rang.name}}</h4>
                    </div>
                  </div>
                </a>
                <!-- <mat-progress-bar *ngIf="true" class="myprogr" color="accent" mode="determinate"
                  value="{{item.progressValue}}">
                </mat-progress-bar> -->
                <div class="d-flex flex-column w-100">
                  <div>
                    <ul class="list-group py-0" *ngIf="item.abilities.length>0">
                      <li *ngFor="let ab of item.abilities" class="list-group-item py-0 mt-1 mb-0 pr-0 pl-0 border-0">
                        <div class="d-flex align-items-baseline w-100">
                          <div class="w-100 d-flex text-primary">
                            <!-- [routerLink]="['/ability', ab.id]" -->
                            <a (click)="showAbility(ab)"
                              [ngClass]="{'text-success' : ab.tasks[0]?.mayUp && ab.tasks[0]?.IsNextLvlSame}"
                              class="flex-grow-1 text-left align-self-baseline">
                              {{ab.name + ' '}}<i><small>{{ab.tasks[0]?.curLvlDescr2}}</small></i>
                            </a>
                            <div fxLayout="row" fxLayoutAlign="space-around" class="text-right align-self-baseline">
                              <a class="pl-2" (click)="showAbility(ab)"
                                [ngClass]="{'text-success' : ab.tasks[0]?.mayUp && ab.tasks[0]?.IsNextLvlSame}">
                                {{ab.rang.name}}
                              </a>
                              <a class="ml-1 px-1" *ngIf="ab.tasks[0]?.mayUp" (click)="upAbil(ab)">
                                <img src="assets/icons/up.png" class="img-fluid"
                                  [ngStyle]="{'object-fit': 'contain', 'height':'1.5em'}">
                              </a>
                            </div>
                          </div>
                        </div>
                        <!-- <mat-progress-bar class="myprogr" color="accent" mode="determinate"
                          value="{{ab.progressValue}}">
                        </mat-progress-bar> -->
                      </li>
                    </ul>
                  </div>
                </div>
              </li>
            </ul>
          </ng-container>
          <br>

          <h5 class="text-right">
            <a [routerLink]="['/turnirtable']" class="badge badge-primary">–¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞</a>
            <a href="https://pashkas.github.io/rpgorganizertutorial.github.io/" target="_blank"
              class="badge badge-secondary">–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ</a>
            <a href="http://rpg-organizer.107353.n8.nabble.com/" target="_blank" class="badge badge-success">–§–æ—Ä—É–º</a>
            <a href="http://nerdistway.blogspot.com/" target="_blank" class="badge badge-warning">–ë–ª–æ–≥</a>
          </h5>
        </div>
      </div>
      <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->
      <div *ngIf="isEditMode" class="pt-2 pb-4 w-100">
        <div class="pb-4">
          <mat-form-field class="w-100">
            <input matInput autocomplete="off" placeholder="–ò–º—è" [(ngModel)]="this.srv.pers.name"
              name="this.srv.pers.name">
          </mat-form-field>
          <mat-form-field class="w-100">
            <input matInput autocomplete="off" placeholder="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" [(ngModel)]="this.srv.pers.image"
              name="this.srv.pers.image">
          </mat-form-field>
          <mat-form-field class="w-100">
            <input matInput autocomplete="off" placeholder="–ò—Å—Ç–æ—Ä–∏—è" [(ngModel)]="this.srv.pers.story"
              name="this.srv.pers.story">
          </mat-form-field>
          <div fxLayout="row" fxLayoutAlign="space-between center">
            <h5>–ê—Ç—Ä–±—É—Ç—ã:</h5>
            <button class="icon-small" mat-icon-button (click)="addCharact()">
              <img src="assets/icons/create.png" class="img-fluid">
            </button>
          </div>
          <mat-list>
            <div mat-list-item *ngFor="let item of this.srv.pers.characteristics; let i = index" class="p-0">
              <div class="d-flex flex-column">
                <!-- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ -->
                <div class="d-flex align-items-center">
                  <div class="flex-grow-1 align-self-center ">
                    <b>{{item.name}}</b>
                  </div>
                  <div class="btn-group btn-group-sm" role="group" aria-label="–î–µ–π—Å—Ç–≤–∏—è">
                    <!-- –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≤—ã–∫ -->
                    <button class="icon-small" id="cha{{i}}" (click)="addAbil(item?.id); selCha=item;" mat-icon-button>
                      <img src="assets/icons/create.png" class="img-fluid">
                    </button>
                    <!-- –£–¥–∞–ª–∏—Ç—å -->
                    <button class="icon-small" (click)="delCharact(item.id)" mat-icon-button>
                      <img src="assets/icons/del.png" class="img-fluid">
                    </button>
                  </div>
                </div>
                <!-- –ù–∞–≤—ã–∫–∏ -->
                <mat-list *ngIf="item.abilities.length>0" class="p-0">
                  <div mat-list-item *ngFor="let ab of item.abilities">
                    <div class="d-flex align-items-center">
                      <div class="flex-grow-1 align-self-center">
                        <i>{{ab.name}}</i>
                      </div>
                      <div class="btn-group btn-group-sm" role="group" aria-label="–î–µ–π—Å—Ç–≤–∏—è">
                        <!-- –£–¥–∞–ª–∏—Ç—å -->
                        <div class="btn-group btn-group-sm" role="group" aria-label="–î–µ–π—Å—Ç–≤–∏—è">
                          <button class="icon-small" (click)="delAbil(ab.id)" mat-icon-button>
                            <img src="assets/icons/del.png" class="img-fluid">
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </mat-list>
              </div>
            </div>
          </mat-list>
          <br>
          <ng-container *ngIf="false">
            <div fxLayout="row" class="my-1" fxLayoutAlign="space-between center" fxLayoutGap="4px"
              *ngFor="let item of this.srv.pers.rangse; let i = index">
              <mat-form-field fxFlex>
                <input matInput autocomplete="off" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" [(ngModel)]="item.name" name="rangName{{i}}">
              </mat-form-field>
              <mat-form-field fxFlex="40">
                <input matInput autocomplete="off" placeholder="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" [(ngModel)]="item.img"
                  name="rangImgs{{i}}">
              </mat-form-field>
              <div fxFlex="20" class="text-center">
                <img src="{{item.img}}" class="img-fluid" style="max-height: 100px">
              </div>
            </div>
          </ng-container>

          <button mat-stroked-button color="accent" class="w-100 mt-2" (click)="resp()">
            –†–µ—Å–ø–∞—É–Ω
          </button>
          <br>
          <br>
        </div>
      </div>
    </mat-tab>

    <mat-tab label="–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å">
      <!-- –ü—Ä–æ—Å–º–æ—Ç—Ä -->
      <div *ngIf="!isEditMode" class="pt-2 pb-4 w-100">
        <div class="pb-4">
          <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
          <div style="padding-left: 10px;" fxFlexFill fxLayoutAlign="center center" fxLayout="row wrap"
            fxLayoutGap="10px grid">
            <div fxFlex="33" *ngFor="let rev of this.srv.pers.inventory">
              <div style="cursor: pointer;" (click)="useRevard(rev)" fxLayout="column"
                fxLayoutAlign="space-around center">
                <img src="{{rev.image}}" class="img-fluid rounded"
                  [ngStyle]="{'object-fit': 'contain', 'height': '65px'}">
                <div fxLayout="row" fxLayoutAlign="space-evenly center">
                  <div>
                    <small>{{rev.name}}</small>
                  </div>
                  <div>
                    &nbsp;<small>x{{rev.count}}</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->
      <div *ngIf="isEditMode" class="pt-2 pb-4 w-100">
        <div class="pb-4">
          <div fxLayout="row" fxLayoutAlign="space-between center">
            <h5>–¢—Ä–æ—Ñ–µ–∏:</h5>
            <!-- –î–æ–±–≤–ª–µ–Ω–∏–µ —Ç—Ä–æ—Ñ–µ—è -->
            <button class="icon-small" mat-icon-button (click)="addNewRevard(null)">
              <img src="assets/icons/create.png" class="img-fluid">
            </button>
          </div>
          <!-- –°–ø–∏—Å–æ–∫ –Ω–∞–≥—Ä–∞–¥ -->
          <mat-list>
            <div mat-list-item *ngFor="let rev of this.srv.pers.rewards; let i = index">
              <div fxFill>
                <div fxFlex fxLayout="row" fxLayoutAlign="start center">
                  <div>
                    {{rev.name}}&nbsp;
                  </div>
                  <span class="badge pointer mr-1" [ngStyle]="{'background-color': rev.rare | rarecol}">
                    {{rev.rare}}
                  </span>
                </div>
                <div>
                  <!-- –£–¥–∞–ª–∏—Ç—å -->
                  <div class="btn-group btn-group-sm" role="group" aria-label="–î–µ–π—Å—Ç–≤–∏—è">
                    <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å -->
                    <button class="icon-small" (click)="addNewRevard(rev)" mat-icon-button>
                      <img src="assets/icons/edit.png" class="img-fluid">
                    </button>
                    <button class="icon-small" (click)="delReward(rev.id)" mat-icon-button>
                      <img src="assets/icons/del.png" class="img-fluid">
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </mat-list>
          <!-- <small class="pt-1" *ngIf="this.srv.pers.totalRewardProbability"><i>–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –Ω–∞–≥—Ä–∞–¥—ã:
              {{this.srv.pers.totalRewardProbability}}%</i></small> -->
          <br>
        </div>
      </div>
    </mat-tab>

    <mat-tab label="–ö–≤–µ—Å—Ç—ã">
      <!-- –ü—Ä–æ—Å–º–æ—Ç—Ä -->
      <div *ngIf="!isEditMode" class="pt-2 pb-4 w-100">
        <div class="pb-4">
          <!-- –ö–≤–µ—Å—Ç—ã -->
          <ng-container *ngIf="this.srv.pers.qwests?.length > 0">

            <ul class="list-group py-0 px-0">
              <li *ngFor="let qwest of this.srv.pers.qwests" class="list-group-item px-0 py-1 border-0">
                <a class="align-self-center w-100" [routerLink]="['/qwest', qwest.id]">
                  <div fxLayout="row" fxLayoutAlign="space-between center">
                    <h6>{{qwest.name}}</h6>
                    <h6>{{qwest.tasksDone}}/{{qwest.tasks.length}}</h6>
                  </div>
                </a>
                <mat-progress-bar class="myprogr" color="accent" mode="determinate" value="{{qwest.progressValue}}">
                </mat-progress-bar>
              </li>
            </ul>
            <br>
          </ng-container>
        </div>
      </div>
      <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->
      <div *ngIf="isEditMode" class="pt-2 pb-4">
        <div class="pb-4">
          <!-- –ö–≤–µ—Å—Ç—ã -->
          <div fxLayout="row" fxLayoutAlign="space-between center">
            <h5>–ö–≤–µ—Å—Ç—ã:</h5>
            <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–≤–µ—Å—Ç–∞ -->
            <button class="icon-small" mat-icon-button (click)="addNewQwest()">
              <img src="assets/icons/create.png" class="img-fluid">
            </button>
          </div>
          <!-- –°–ø–∏—Å–æ–∫ –∫–≤–µ—Å—Ç–æ–≤ -->
          <mat-list>
            <div mat-list-item *ngFor="let qwest of this.srv.pers.qwests; let i = index">
              <div class="d-flex align-items-center">
                <div class="flex-grow-1 align-self-center">
                  {{qwest.name}}
                </div>
                <div class="d-flex">
                  <!-- –£–¥–∞–ª–∏—Ç—å -->
                  <div class="btn-group btn-group-sm" role="group" aria-label="–î–µ–π—Å—Ç–≤–∏—è">
                    <button class="icon-small" (click)="delQwest(qwest.id)" mat-icon-button>
                      <img src="assets/icons/del.png" class="img-fluid">
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </mat-list>
          <br>
        </div>
      </div>
    </mat-tab>

    <mat-tab label="üìñ">
      <app-diary [isEditMode]="isEditMode">
      </app-diary>
    </mat-tab>
  </mat-tab-group>
  <br>
  <br>
</div>